{% extends 'baza.html' %}
{% load static %}

{% block content %}
<html>
<head>
    <title>Log Accesari</title>
    <style>
        .error { color: red; }
        .log-entry { margin: 5px 0; padding: 5px; border-bottom: 1px solid #eee; }
        .section { margin: 20px 0; }
        .section-title { font-size: 1.2em; font-weight: bold; margin-bottom: 10px; }
        .access-details { list-style-type: disc; margin-left: 20px; }
        table { border-collapse: collapse; width: 100%; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        .stats { background-color: #f8f9fa; padding: 15px; border-radius: 5px; margin: 20px 0; }
        .stat-item { margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Istoricul accesarilor</h1>

    {% if error_message %}
        <p class="error">{{ error_message }}</p>
    {% endif %}

    {% if show_access_count %}
        <div class="section">
            <div class="section-title">Numarul total de accesari</div>
            <p>Au fost inregistrate <strong>{{ total_logs }}</strong> accesari de cand serverul a fost pornit.</p>
        </div>
    {% endif %}

    {% if show_access_details %}
        <div class="section">
            <div class="section-title">Detalii complete ale accesarilor</div>
            <ul class="access-details">
                {% for log in logs %}
                    <li>
                        <strong>{{ log.afis_data }}</strong> - 
                        {{ log.method }} <code>{{ log.path }}</code> - 
                        {{ log.ip_address }} (ID: {{ log.id }})
                    </li>
                {% empty %}
                    <li>Nu exista accesari inregistrate.</li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}

    {% if show_table %}
        <div class="section">
            <div class="section-title">
                Tabel accesari 
                {% if logs_by_id %}
                    (dupa ID-uri)
                {% else %}
                    (toate accesÄƒrile)
                {% endif %}
            </div>
            
            <table>
                <thead>
                    <tr>
                        {% for column in table_columns %}
                            <th>
                                {% if column == 'id' %}ID
                                {% elif column == 'timestamp' %}Timestamp
                                {% elif column == 'method' %}Method
                                {% elif column == 'path' %}URL
                                {% elif column == 'ip_address' %}IP Address
                                {% else %}{{ column }}{% endif %}
                            </th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for log in table_data %}
                        <tr>
                            {% for column in table_columns %}
                                <td>
                                    {% if column == 'id' %}{{ log.id }}
                                    {% elif column == 'timestamp' %}{{ log.afis_data }}
                                    {% elif column == 'method' %}{{ log.method }}
                                    {% elif column == 'path' %}{{ log.path }}
                                    {% elif column == 'ip_address' %}{{ log.ip_address }}
                                    {% endif %}
                                </td>
                            {% endfor %}
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="{{ table_columns|length }}">Nu exista date de afisat</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}

    {% if logs_by_id and not show_table %}
        <div class="section">
            <div class="section-title">Accesari dupa ID-uri</div>
            <p>Parametrul dubluri este setat la: <strong>{{ allow_duplicates }}</strong></p>
            
            <div class="log-entries">
                {% for log in logs_by_id %}
                    <div class="log-entry">
                        <strong>ID {{ log.id }}</strong> - 
                        {{ log.method }} <code>{{ log.path }}</code> - 
                        {{ log.ip_address }}
                    </div>
                {% empty %}
                    <p>Nu s-au gasit accesari pentru ID-urile specificate.</p>
                {% endfor %}
            </div>
        </div>
    {% endif %}

    {% if not show_table %}
        <div class="section">
            <div class="section-title">Istoricul accesarilor</div>
            <p>Total accesari afisate: {{ logs|length }}</p>
            <div class="log-entries">
                {% for log in logs %}
                    <div class="log-entry">
                        <strong>ID {{ log.id }}</strong> - 
                        {{ log.method }} <code>{{ log.path }}</code> - 
                        {{ log.ip_address }}
                    </div>
                {% empty %}
                    <p>Nu exista accesari inregistrate.</p>
                {% endfor %}
            </div>
        </div>
    {% endif %}


    <div class="stats">
        <div class="section-title">Statistici Accesari Pagini</div>
        
        {% if least_accessed and most_accessed %}
            <div class="stat-item">
                <strong>Pagina cea mai putin accesata:</strong>
                <code>{{ least_accessed.path }}</code> 
                ({{ least_accessed.access_count }} accesari)
            </div>
            
            <div class="stat-item">
                <strong>Pagina cea mai accesata:</strong>
                <code>{{ most_accessed.path }}</code> 
                ({{ most_accessed.access_count }} accesari)
            </div>
        {% else %}
            <p>Nu exista suficiente date pentru statistici.</p>
        {% endif %}
    </div>
    <div class="section">
    <a href="{% url 'info' %}">Vezi pagina de informatii</a>
</div>

</body>
</html>
{% endblock %}
